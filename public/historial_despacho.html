<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial Despacho</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
  <div class="contenedor">
    <h1>Historial de Códigos NET</h1>
    <input type="text" id="buscar" placeholder="Buscar código NET...">
    <ul id="historial"></ul>
    <div id="paginacion" style="margin-top:20px; text-align:center;">
      <button id="anterior">Anterior</button>
      <span id="pagina-actual"></span>
      <button id="siguiente">Siguiente</button>
    </div>
  </div>

  <script>
    let pagina = 1;
    const limite = 10; // Cambia este valor si quieres más o menos registros por página

    async function cargarHistorial() {
      try {
        const res = await fetch(`/historial-net?page=${pagina}&limit=${limite}`);
        const { lista, totalPaginas } = await res.json();
        const contenedor = document.getElementById('historial');
        contenedor.innerHTML = '';
        lista.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>${item.codigo_net}</strong><br>
            Cliente: ${item.nombre_cliente}<br>
            Coordenadas: ${item.coordenadas || ''}<br>
            <img src="${item.foto}" alt="Foto del cliente" loading="lazy" style="max-width:200px;max-height:200px;"><br>
            <a href="${item.foto}" target="_blank">Ver foto</a>
          `;
          contenedor.appendChild(li);
        });
        document.getElementById('pagina-actual').textContent = `Página ${pagina} de ${totalPaginas}`;
        document.getElementById('anterior').disabled = pagina === 1;
        document.getElementById('siguiente').disabled = pagina === totalPaginas;
      } catch (err) {
        console.error('Error al cargar historial:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('anterior').addEventListener('click', () => {
        if (pagina > 1) {
          pagina--;
          cargarHistorial();
        }
      });

      document.getElementById('siguiente').addEventListener('click', () => {
        pagina++;
        cargarHistorial();
      });

      document.getElementById('buscar').addEventListener('input', () => {
        const filtro = document.getElementById('buscar').value.toLowerCase();
        const items = document.querySelectorAll('#historial li');
        items.forEach(item => {
          item.style.display = item.innerText.toLowerCase().includes(filtro) ? '' : 'none';
        });
      });

      cargarHistorial();
    });