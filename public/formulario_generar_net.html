<body>
    <link rel="stylesheet" href="estilos.css">
  <div class="contenedor">
    <h1>Generar Código NET</h1>

    <form id="formulario" enctype="multipart/form-data">
      <input type="text" name="nombre_cliente" placeholder="Nombre del cliente" required>
      <input type="text" name="coordenadas" placeholder="Coordenadas" required>
      <input type="file" name="foto" accept="image/*" required>
      <button type="submit">Generar Código NET</button>
    </form>

    <h2>Historial de Códigos NET Generados</h2>
    <ul id="historial"></ul>
  </div>

  <script>
    async function cargarHistorial() {
      try {
        const res = await fetch('/historial-net');
        const lista = await res.json();
        const contenedor = document.getElementById('historial');
        contenedor.innerHTML = '';
        lista.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>${item.codigo_net}</strong><br>
            Cliente: ${item.nombre_cliente}<br>
            Coordenadas: ${item.coordenadas}<br>
            <img src="${item.foto}" alt="Foto del cliente">
            <a href="${item.foto}" target="_blank">Ver foto</a>
          `;
          contenedor.appendChild(li);
        });
      } catch (err) {
        console.error('Error al cargar historial:', err);
      }
    }

    document.getElementById('formulario').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      try {
        const res = await fetch('/generar-net', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();
        if (data.codigo) {
          alert('Código generado: ' + data.codigo);
          e.target.reset();
          cargarHistorial();
        } else {
          alert('Error: ' + data.error);
        }
      } catch (err) {
        console.error('Error generando código:', err);
        alert('Error inesperado');
      }
    });

    cargarHistorial();
  </script>


</body>
